let moveTimes = 0;
document.querySelectorAll(".ring").forEach((e) => {
  e.addEventListener("mouseenter", () => {
    e.style.animation = "animate-pulse 0.5s infinite";
  }),
    e.addEventListener("mouseleave", () => {
      e.style.animation = "none";
    }),
    e.addEventListener("dragstart", (t) => {
      if (!isTrueMove(e)) {
        t.preventDefault(), alert("Only top ring is allowed to move!");
        return;
      }
      t.dataTransfer.setData("draggedRing", t.target.id);
    });
});
const isTrueMove = (e) => {
  let t = e.parentElement,
    r = t.querySelectorAll(".ring");
  return r[0] == e;
};
document.querySelectorAll(".peg").forEach((e) => {
  e.addEventListener("dragover", (e) => {
    e.preventDefault();
  }),
    e.addEventListener("drop", (e) => {
      e.preventDefault();
      let t = e.dataTransfer.getData("draggedRing"),
        r = document.getElementById(t),
        n = e.target;
      if (n.classList.contains("peg")) {
        let a = Array.from(n.querySelectorAll(".ring"));
        if (a.length > 0) {
          let l = a[0];
          parseInt(r.getAttribute("data-ring")) <
          parseInt(l.getAttribute("data-ring"))
            ? (n.appendChild(r), moveTimes++)
            : alert(
                "A larger ring cannot be placed on top of a smaller ring. Please move the rings accordingly."
              );
        } else n.appendChild(r), moveTimes++;
        rearrangement(), winCondition();
      } else alert("Make sure to drop the ring on the peg.");
    });
});
const rearrangement = () => {
    document.querySelectorAll(".peg").forEach((e) => {
      (rearrangeRings = Array.from(e.getElementsByClassName("ring"))).sort(
        (e, t) =>
          parseInt(e.getAttribute("data-ring")) -
          parseInt(t.getAttribute("data-ring"))
      ),
        rearrangeRings.forEach((t) => {
          e.appendChild(t);
        });
    });
  },
  winCondition = () => {
    document.querySelectorAll(".peg").forEach((e) => {
      let t = e.querySelectorAll(".ring");
      3 === t.length &&
        setTimeout(() => {
          alert("Congratulations! You win the game.");
        }, 2e3);
    });
  };
document.getElementById("resetBtn").addEventListener("click", () => {
  let e = document.getElementById("peg2"),
    t = document.querySelectorAll(".ring");
  t.forEach((t) => {
    e.appendChild(t), rearrangement();
  });
});
