const API_BASE_URL = "https://www.themealdb.com/api/json/v1/1";
window.onload = () => loadCategories();
const loadCategories = async () => {
    try {
      let e = await fetch(`${API_BASE_URL}/categories.php`);
      if (!e.ok) throw Error("Category loading fail!");
      let t = await e.json();
      t
        ? t.categories.forEach((e) => {
            let t = document.createElement("option");
            (t.value = e.strCategory),
              (t.textContent = e.strCategory),
              document.getElementById("categorySelect").appendChild(t);
          })
        : console.error("Fetching data failed!");
    } catch (a) {
      console.error("Error loading categories: ", a);
    }
  },
  searchRecipes = async () => {
    let e = document.getElementById("searchInput").value.trim();
    if (e) {
      showLoading(!0), clearResults();
      try {
        let t = await fetch(`${API_BASE_URL}/search.php?s=${e}`),
          a = await t.json();
        displayResults(a.meals || []);
      } catch (s) {
        console.error("Error feching recipes: ", s),
          displayError("Failed to fetch recipes. Please try again later.");
      } finally {
        showLoading(!1);
      }
    }
  };
document.getElementById("searchInput").addEventListener("keypress", (e) => {
  "Enter" === e.key && searchRecipes();
});
const searchByCategory = async () => {
    let e = document.getElementById("categorySelect").value;
    if (e) {
      showLoading(!0), clearResults();
      try {
        let t = await fetch(`${API_BASE_URL}/filter.php?c=${e}`),
          a = await t.json();
        displayResults(a.meals || []);
      } catch (s) {
        console.error("Error fetching category recipes:", s),
          displayError("Failed to fetch recipes. Please try again.");
      } finally {
        showLoading(!1);
      }
    }
  },
  displayResults = (e) => {
    let t = document.getElementById("results");
    if (0 === e.length) {
      displayError("No recipes found. Try a different search term.");
      return;
    }
    e.forEach((e) => {
      let a = document.createElement("div");
      (a.className =
        "bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow"),
        (a.innerHTML = `
                      <img src="${e.strMealThumb}" alt="${e.strMeal}" class="w-full h-48 object-cover">
                      <div class="p-4">
                          <h3 class="text-lg font-semibold text-gray-800 mb-2">${e.strMeal}</h3>
                          <button
                              onclick="showRecipeDetails('${e.idMeal}')"
                              class="bg-purple-500 text-white px-4 py-2 rounded-md hover:bg-purple-600 transition-colors w-full"
                          >
                              View Recipe
                          </button>
                      </div>
                  `),
        t.appendChild(a);
    });
  },
  showLoading = (e) => {
    document.getElementById("loading").classList.toggle("hidden", !e);
  },
  clearResults = () => {
    document.getElementById("results").innerHTML = "";
  },
  showRecipeDetails = async (e) => {
    showLoading(!0),
      document.getElementById("recipeModal").classList.remove("hidden");
    try {
      let t = await fetch(`${API_BASE_URL}/lookup.php?i=${e}`),
        a = await t.json(),
        s = a.meals[0],
        l = [];
      for (let r = 1; r <= 20; r++) {
        let i = s[`strIngredient${r}`],
          o = s[`strMeasure${r}`];
        i && i.trim() && l.push(`${o.trim()} ${i.trim()}`);
      }
      (document.getElementById("modalTitle").textContent = s.strMeal),
        (document.getElementById("modalContent").innerHTML = `
                    <img src="${s.strMealThumb}" alt="${
          s.strMeal
        }" class="w-full h-64 object-cover rounded-lg mb-4">
                    <div class="mb-4">
                        <p class="text-gray-600">Category: ${s.strCategory}</p>
                        <p class="text-gray-600">Origin: ${
                          s.strArea || "Not specified"
                        }</p>
                    </div>
                    <div class="mb-4">
                        <h3 class="text-xl font-semibold mb-2">Ingredients</h3>
                        <ul class="list-disc pl-5">
                            ${l.map((e) => `<li>${e}</li>`).join("")}
                        </ul>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold mb-2">Instructions</h3>
                        <p class="whitespace-pre-line">${s.strInstructions}</p>
                    </div>
                    ${
                      s.strYoutube
                        ? `
                        <div class="mt-4">
                            <h3 class="text-xl font-semibold mb-2">Video Tutorial</h3>
                            <a href="${s.strYoutube}" target="_blank" class="text-purple-500 hover:text-purple-600">
                                Watch on YouTube
                            </a>
                        </div>
                    `
                        : ""
                    }
                `);
    } catch (n) {
      console.error("Error fetching recipe details:", n),
        displayError("Failed to fetch recipe details. Please try again.");
    } finally {
      showLoading(!1);
    }
  },
  closeModal = () => {
    document.getElementById("recipeModal").classList.add("hidden");
  };
document.getElementById("recipeModal").addEventListener("click", (e) => {
  e.target === document.getElementById("recipeModal") && closeModal();
});
const displayError = (e) => {
  let t = document.getElementById("results");
  t.innerHTML = `
          <div class="col-span-full text-center text-red-500 py-4">
              ${e}
          </div>
      `;
};
